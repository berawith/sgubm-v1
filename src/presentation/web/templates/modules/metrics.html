<div id="metrics-view" class="view" style="display: none;">
    <div class="header-modern"
        style="margin-bottom: 24px; display: flex; align-items: center; justify-content: space-between;">
        <div>
            <h1 style="font-size: 2rem; font-weight: 900; color: #1e293b; margin: 0; letter-spacing: -0.02em;">Centro de
                Comando NOC</h1>
            <p
                style="font-size: 0.85rem; font-weight: 700; color: #64748b; letter-spacing: 0.1em; text-transform: uppercase;">
                Métricas, Telemetría y Análisis de Red en Tiempo Real</p>
        </div>
        <div class="actions" style="display: flex; gap: 12px; align-items: center;">
            <div
                style="background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 12px; padding: 8px 16px; display: flex; align-items: center; gap: 8px;">
                <div
                    style="width: 8px; height: 8px; background: #10b981; border-radius: 50%; box-shadow: 0 0 10px #10b981; animation: pulse 2s infinite;">
                </div>
                <span
                    style="font-size: 0.75rem; font-weight: 800; color: #10b981; text-transform: uppercase; letter-spacing: 0.1em;">Sistema
                    Activo</span>
            </div>
        </div>
    </div>

    <!-- Buscador Dual -->
    <div class="modern-panel"
        style="background: #ffffff; border-radius: 20px; border: 1px solid rgba(226,232,240,0.8); box-shadow: 0 10px 25px -5px rgba(0,0,0,0.02); padding: 24px; margin-bottom: 32px; overflow: visible; position: relative; z-index: 50;">
        <div style="display: flex; gap: 16px; align-items: flex-end;">
            <div style="flex: 1;">
                <label
                    style="display: block; font-size: 0.7rem; font-weight: 800; color: #64748b; text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 8px;"><i
                        class="fas fa-search"></i> Buscar Objetivo (Cliente / IP / Router)</label>
                <div style="position: relative;">
                    <i class="fas fa-crosshairs"
                        style="position: absolute; left: 16px; top: 50%; transform: translateY(-50%); color: #94a3b8; z-index: 2;"></i>
                    <input type="text" id="metrics-search-input"
                        placeholder="Ej: Juan Perez, 192.168.1.10, o Nodo Principal..."
                        style="width: 100%; padding: 16px 16px 16px 48px; border-radius: 12px; border: 1px solid #e2e8f0; font-size: 1rem; color: #1e293b; background: #f8fafc; transition: all 0.2s; position: relative; z-index: 1;"
                        onfocus="this.style.boxShadow='0 0 0 3px rgba(99, 102, 241, 0.2)'; this.style.borderColor='#6366f1';"
                        onblur="this.style.boxShadow='none'; this.style.borderColor='#e2e8f0';">
                    <!-- Contenedor de Resultados del Buscador -->
                    <div id="metrics-search-results"
                        style="display: none; position: absolute; top: calc(100% + 12px); left: 0; right: 0; background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border: 1px solid rgba(226,232,240,0.8); border-radius: 16px; box-shadow: 0 20px 40px -10px rgba(0,0,0,0.08), 0 0 0 1px rgba(0,0,0,0.02); z-index: 100; max-height: 400px; overflow-y: auto; overflow-x: hidden; padding: 8px;">
                    </div>
                </div>
            </div>
            <button id="btn-metrics-search" class="btn-primary"
                style="padding: 16px 32px; border-radius: 12px; font-weight: 700; display: flex; align-items: center; gap: 8px;">
                <i class="fas fa-radar"></i> Analizar
            </button>
        </div>
    </div>

    <!-- Loader / Placeholder -->
    <div id="metrics-placeholder"
        style="display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 60px 20px; text-align: center;">
        <i class="fas fa-satellite-dish" style="font-size: 4rem; color: #cbd5e1; margin-bottom: 24px;"></i>
        <h3 style="font-size: 1.25rem; font-weight: 800; color: #64748b; margin: 0;">Seleccione un objetivo</h3>
        <p style="color: #94a3b8; font-size: 0.9rem; margin-top: 8px;">Ingrese el nombre, IP o seleccione un router para
            iniciar el análisis telemétrico.</p>
    </div>

    <!-- Contenido del Dashboard (Oculto por defecto) -->
    <div id="metrics-dashboard" style="display: none;">
        <!-- Cabecera del Objetivo -->
        <div
            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; padding-bottom: 16px; border-bottom: 1px solid rgba(226, 232, 240, 0.8);">
            <div>
                <h2 id="metrics-target-name" style="font-size: 1.5rem; font-weight: 800; color: #0f172a; margin: 0;">--
                </h2>
                <span id="metrics-target-type"
                    style="font-size: 0.8rem; font-weight: 700; color: #6366f1; text-transform: uppercase; letter-spacing: 0.1em; background: rgba(99, 102, 241, 0.1); padding: 4px 12px; border-radius: 20px; display: inline-block; margin-top: 8px;">--</span>
            </div>

            <!-- Widget Consumo Live -->
            <div id="metrics-live-consumption"
                style="display: none; background: #ffffff; border: 1px solid rgba(226,232,240,0.8); border-radius: 16px; padding: 12px 24px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.02), inset 0 2px 4px rgba(255,255,255,0.5); align-items: center; gap: 32px;">
                <div style="display: flex; flex-direction: column; align-items: flex-start;">
                    <span
                        style="font-size: 0.65rem; font-weight: 800; color: #10b981; text-transform: uppercase; letter-spacing: 0.1em; display: flex; align-items: center; gap: 6px; margin-bottom: 4px;"><i
                            class="fas fa-arrow-down"
                            style="background: rgba(16,185,129,0.1); padding: 4px; border-radius: 50%;"></i>
                        Descarga</span>
                    <span id="metrics-live-rx"
                        style="font-family: 'JetBrains Mono', monospace; font-size: 1.5rem; font-weight: 900; color: #0f172a; display: flex; align-items: baseline; gap: 4px;">0.00
                        <span id="metrics-live-rx-unit"
                            style="font-size: 0.75rem; color: #64748b; font-weight: 700;">Mbps</span></span>
                </div>
                <div style="width: 1px; height: 32px; background: #e2e8f0;"></div>
                <div style="display: flex; flex-direction: column; align-items: flex-start;">
                    <span
                        style="font-size: 0.65rem; font-weight: 800; color: #8b5cf6; text-transform: uppercase; letter-spacing: 0.1em; display: flex; align-items: center; gap: 6px; margin-bottom: 4px;"><i
                            class="fas fa-arrow-up"
                            style="background: rgba(139,92,246,0.1); padding: 4px; border-radius: 50%;"></i>
                        Subida</span>
                    <span id="metrics-live-tx"
                        style="font-family: 'JetBrains Mono', monospace; font-size: 1.5rem; font-weight: 900; color: #0f172a; display: flex; align-items: baseline; gap: 4px;">0.00
                        <span id="metrics-live-tx-unit"
                            style="font-size: 0.75rem; color: #64748b; font-weight: 700;">Mbps</span></span>
                </div>
            </div>

            <div style="text-align: right;">
                <span
                    style="font-size: 0.7rem; font-weight: 800; color: #94a3b8; text-transform: uppercase; letter-spacing: 0.1em; display: block;">Última
                    Actualización</span>
                <span id="metrics-last-sync"
                    style="font-family: 'JetBrains Mono', monospace; font-size: 0.9rem; font-weight: 600; color: #334155;">--:--:--</span>
            </div>
        </div>

        <div class="form-grid compact-grid" style="gap: 24px;">
            <!-- Panel LHI -->
            <div class="modern-panel"
                style="grid-column: span 12; background: #ffffff; border-radius: 20px; border: 1px solid rgba(226,232,240,0.8); box-shadow: 0 10px 25px -5px rgba(0,0,0,0.02); overflow: hidden;">
                <div class="panel-header-modern"
                    style="padding: 16px 24px; border-bottom: 1px solid rgba(226,232,240,0.6); background: rgba(248,250,252,0.5);">
                    <div class="panel-title"
                        style="font-size: 0.9rem; font-weight: 800; color: #334155; display: flex; align-items: center; justify-content: space-between;">
                        <div><i class="fas fa-heartbeat" style="color: #6366f1; margin-right: 8px;"></i> Salud de Red
                            (LHI en vivo)</div>
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <button id="btn-metrics-lhi-detail" class="btn-secondary"
                                style="padding: 4px 12px; font-size: 0.75rem; border-radius: 8px; display: none; font-weight: 700;"><i
                                    class="fas fa-microscope" style="margin-right: 6px;"></i>Análisis Detallado</button>
                            <div id="metrics-lhi-badge"></div>
                        </div>
                    </div>
                </div>
                <div class="panel-body-modern" style="padding: 24px;">
                    <div class="chart-container-modal" style="height: 350px; position: relative; width: 100%;">
                        <canvas id="metrics-stability-chart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Panel Tráfico -->
            <div class="modern-panel"
                style="grid-column: span 8; background: #ffffff; border-radius: 20px; border: 1px solid rgba(226,232,240,0.8); box-shadow: 0 10px 25px -5px rgba(0,0,0,0.02); overflow: hidden;">
                <div class="panel-header-modern"
                    style="padding: 16px 24px; border-bottom: 1px solid rgba(226,232,240,0.6); background: rgba(248,250,252,0.5); display: flex; justify-content: space-between; align-items: center;">
                    <div class="panel-title" style="font-size: 0.9rem; font-weight: 800; color: #334155;"><i
                            class="fas fa-chart-line" style="color: #6366f1; margin-right: 8px;"></i> Consumo de Tráfico
                        (Throughput)</div>

                    <div class="chart-range-selector"
                        style="display: flex; gap: 4px; background: #f1f5f9; padding: 4px; border-radius: 12px;">
                        <button class="traffic-range-btn active" data-range="live"
                            style="border: none; background: #ffffff; color: #6366f1; font-size: 0.72rem; font-weight: 700; padding: 5px 10px; border-radius: 8px; cursor: pointer; transition: all 0.2s; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">LIVE</button>
                        <button class="traffic-range-btn" data-range="24h"
                            style="border: none; background: transparent; color: #64748b; font-size: 0.72rem; font-weight: 600; padding: 5px 10px; border-radius: 8px; cursor: pointer; transition: all 0.2s;">24H</button>
                        <button class="traffic-range-btn" data-range="7d"
                            style="border: none; background: transparent; color: #64748b; font-size: 0.72rem; font-weight: 600; padding: 5px 10px; border-radius: 8px; cursor: pointer; transition: all 0.2s;">7D</button>
                    </div>
                </div>
                <div class="panel-body-modern" style="padding: 24px;">
                    <div class="chart-container-modal" style="height: 300px; position: relative; width: 100%;">
                        <canvas id="metrics-traffic-chart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Inteligencia NOC -->
            <div class="modern-panel"
                style="grid-column: span 4; background: #ffffff; border-radius: 20px; border: 1px solid rgba(226,232,240,0.8); box-shadow: 0 10px 25px -5px rgba(0,0,0,0.02); overflow: hidden;">
                <div class="panel-header-modern"
                    style="padding: 16px 24px; border-bottom: 1px solid rgba(226,232,240,0.6); background: rgba(248,250,252,0.5);">
                    <div class="panel-title" style="font-size: 0.9rem; font-weight: 800; color: #334155;"><i
                            class="fas fa-brain" style="color: #8b5cf6; margin-right: 8px;"></i> Inteligencia NOC</div>
                </div>
                <div class="panel-body-modern" style="padding: 24px;">
                    <div style="display: flex; flex-direction: column; gap: 20px;">
                        <div>
                            <span
                                style="font-size: 0.7rem; font-weight: 800; color: #64748b; text-transform: uppercase; letter-spacing: 0.1em; display: block; margin-bottom: 4px;">Perfil
                                de Uso</span>
                            <div id="metrics-profile" style="font-size: 1.1rem; font-weight: 900; color: #0f172a;">--
                            </div>
                        </div>
                        <div>
                            <span
                                style="font-size: 0.7rem; font-weight: 800; color: #64748b; text-transform: uppercase; letter-spacing: 0.1em; display: block; margin-bottom: 4px;">Consumo
                                Estimado Mensual</span>
                            <div id="metrics-estimated-gb" style="font-size: 1.1rem; font-weight: 900; color: #0f172a;">
                                -- GB</div>
                        </div>
                        <div>
                            <span
                                style="font-size: 0.7rem; font-weight: 800; color: #64748b; text-transform: uppercase; letter-spacing: 0.1em; display: block; margin-bottom: 4px;">Hora
                                Pico</span>
                            <div id="metrics-peak-hour"
                                style="font-family: 'JetBrains Mono', monospace; font-size: 1.1rem; font-weight: 900; color: #0f172a;">
                                --:--</div>
                        </div>
                        <div style="padding-top: 16px; border-top: 1px dashed rgba(226, 232, 240, 0.8);">
                            <span
                                style="font-size: 0.7rem; font-weight: 800; color: #64748b; text-transform: uppercase; letter-spacing: 0.1em; display: block; margin-bottom: 4px;">Recomendación
                                IA</span>
                            <div id="metrics-ai-recommendation"
                                style="font-size: 1.1rem; font-weight: 900; color: #10b981;">--</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Historial Analítico de Anomalías -->
            <div class="modern-panel"
                style="grid-column: span 12; background: #ffffff; border-radius: 20px; border: 1px solid rgba(226,232,240,0.8); box-shadow: 0 10px 25px -5px rgba(0,0,0,0.02); overflow: hidden;">
                <div class="panel-header-modern"
                    style="padding: 16px 24px; border-bottom: 1px solid rgba(226,232,240,0.6); background: rgba(248,250,252,0.5);">
                    <div class="panel-title" style="font-size: 0.9rem; font-weight: 800; color: #334155;"><i
                            class="fas fa-clipboard-list" style="color: #6366f1; margin-right: 8px;"></i> Registro de
                        Telemetría (Anomalías)</div>
                </div>
                <div class="panel-body-modern" style="padding: 0; max-height: 400px; overflow-y: auto;">
                    <div id="metrics-history-table">
                        <p style="padding: 24px; text-align: center; color: #94a3b8; font-weight: 600;">Esperando
                            datos...</p>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<style>
    @media (max-width: 1024px) {
        .header-modern {
            flex-direction: column;
            align-items: flex-start !important;
            gap: 15px;
        }

        .header-modern h1 {
            font-size: 1.5rem !important;
        }

        .modern-panel>div {
            flex-direction: column !important;
            align-items: stretch !important;
        }

        #metrics-search-input {
            width: 100% !important;
        }

        #btn-metrics-search {
            width: 100%;
            justify-content: center;
        }

        #metrics-live-consumption {
            width: 100%;
            justify-content: space-around;
            gap: 10px !important;
            padding: 12px !important;
        }

        .form-grid.compact-grid {
            display: flex !important;
            flex-direction: column !important;
            gap: 16px !important;
        }

        .modern-panel {
            grid-column: span 12 !important;
        }

        #metrics-dashboard>div:first-child {
            flex-direction: column;
            align-items: stretch !important;
            gap: 20px;
        }
    }
</style>

<!-- Modal Análisis Detallado LHI -->
<div id="lhi-detail-modal" class="modal">
    <div class="modal-content"
        style="max-width: 600px; border-radius: 20px; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);">
        <div class="modal-header" style="border-bottom: 1px solid #e2e8f0; padding: 20px 24px;">
            <div style="display: flex; align-items: center; gap: 12px;">
                <div
                    style="background: #e0e7ff; color: #4f46e5; width: 40px; height: 40px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.25rem;">
                    <i class="fas fa-microscope"></i>
                </div>
                <div>
                    <h2 style="font-size: 1.25rem; font-weight: 800; color: #0f172a; margin: 0;">Análisis y Diagnóstico
                        LHI</h2>
                    <p style="font-size: 0.8rem; color: #64748b; margin: 0; font-weight: 600;">Evaluación algorítmica de
                        calidad de red</p>
                </div>
            </div>
            <span class="close btn-close-modal"
                style="font-size: 1.5rem; color: #94a3b8; transition: color 0.2s;">&times;</span>
        </div>
        <div class="modal-body" style="padding: 24px; max-height: 70vh; overflow-y: auto;">

            <!-- Resumen Indicadores -->
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-bottom: 24px;">
                <div
                    style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 12px; padding: 16px; text-align: center;">
                    <div
                        style="font-size: 0.70rem; font-weight: 800; color: #64748b; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 8px;">
                        Ping Prom.</div>
                    <div id="lhi-detail-ping" style="font-size: 1.25rem; font-weight: 900; color: #3b82f6;">--</div>
                </div>
                <div
                    style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 12px; padding: 16px; text-align: center;">
                    <div
                        style="font-size: 0.70rem; font-weight: 800; color: #64748b; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 8px;">
                        Jitter Prom.</div>
                    <div id="lhi-detail-jitter" style="font-size: 1.25rem; font-weight: 900; color: #10b981;">--</div>
                </div>
                <div
                    style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 12px; padding: 16px; text-align: center;">
                    <div
                        style="font-size: 0.70rem; font-weight: 800; color: #64748b; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 8px;">
                        Perdida Paq.</div>
                    <div id="lhi-detail-loss" style="font-size: 1.25rem; font-weight: 900; color: #ef4444;">--</div>
                </div>
            </div>

            <!-- Caja de Estado -->
            <div id="lhi-detail-status-box"
                style="padding: 16px; border-radius: 12px; margin-bottom: 24px; border-left: 4px solid #6366f1; background: #f1f5f9;">
                <h4 id="lhi-detail-status-title"
                    style="margin: 0 0 8px 0; font-size: 1.05rem; font-weight: 800; color: #1e293b;">Estado Actual</h4>
                <p id="lhi-detail-status-desc" style="margin: 0; font-size: 0.9rem; color: #475569; line-height: 1.5;">
                </p>
            </div>

            <!-- Recomendaciones -->
            <div style="margin-bottom: 16px;">
                <h4
                    style="margin: 0 0 12px 0; font-size: 0.95rem; font-weight: 800; color: #334155; display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-magic" style="color: #eab308;"></i> Recomendaciones del Sistema
                </h4>
                <ul id="lhi-detail-recommendations"
                    style="margin: 0; padding-left: 20px; display: flex; flex-direction: column; gap: 10px; font-size: 0.9rem; color: #475569; line-height: 1.4;">
                </ul>
            </div>

        </div>
        <div class="modal-footer"
            style="border-top: 1px solid #e2e8f0; padding: 16px 24px; background: #f8fafc; border-radius: 0 0 20px 20px; display: flex; justify-content: flex-end;">
            <button class="btn-primary btn-close-modal"
                style="padding: 10px 24px; border-radius: 8px; font-weight: 700;">Entendido</button>
        </div>
    </div>
</div>