<div id="finance-overview-view" class="view content-view" style="display: none;">
    <div class="view-header">
        <div class="header-left">
            <h1 class="page-title">Resumen Financiero</h1>
            <p class="page-subtitle">Métricas generales de recaudación y estado de cartera</p>
        </div>
        <div class="header-right">
            <div class="financial-clock-premium">
                <div id="live-time" class="clock-time">00:00:00</div>
                <div id="live-date" class="clock-date">Cargando fecha...</div>
            </div>
        </div>
    </div>

    <!-- Pestañas Principales (Sub-navegación interna) -->
    <div class="finance-tabs-premium"
        style="display: flex; gap: 8px; margin-bottom: 24px; border-bottom: 1px solid #e2e8f0; padding-bottom: 12px; position: relative; z-index: 10;">
        <button class="finance-tab-btn active"
            onclick="if(window.app) window.app.modules.payments.switchOverviewTab('ingresos')" id="tab-btn-ingresos">
            <i class="fas fa-hand-holding-usd"></i> Ingresos
        </button>
        <button class="finance-tab-btn"
            onclick="if(window.app) window.app.modules.payments.switchOverviewTab('egresos')" id="tab-btn-egresos">
            <i class="fas fa-file-invoice-dollar"></i> Egresos & Gastos
        </button>
        <button class="finance-tab-btn"
            onclick="if(window.app) window.app.modules.payments.switchOverviewTab('perdidas')" id="tab-btn-perdidas">
            <i class="fas fa-exclamation-triangle"></i> Pérdidas & Ajustes
        </button>
    </div>

    <!-- Tab 1: Ingresos -->
    <div id="finance-tab-ingresos" class="finance-tab-content active">
        <div class="stat-grid-premium"
            style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 16px; margin-bottom: 24px;">
            <div class="stat-card-premium" style="border-left-color: #6366f1;">
                <div class="stat-label">Recaudación Hoy</div>
                <div id="pay-stat-today-main" class="stat-value">$0.00</div>
                <div class="stat-sub">Ingresos del día</div>
            </div>
            <div class="stat-card-premium" style="border-left-color: #ec4899;">
                <div class="stat-label">Este Mes</div>
                <div id="pay-stat-month-main" class="stat-value">$0.00</div>
                <div class="stat-sub">Acumulado mensual</div>
            </div>
            <div class="stat-card-premium" style="border-left-color: #8b5cf6;">
                <div class="stat-label">Dif. en Cambio</div>
                <div id="pay-stat-fx-main" class="stat-value">$0.00</div>
                <div class="stat-sub">Balance cambiario</div>
            </div>
            <div class="stat-card-premium" style="border-left-color: #f43f5e;">
                <div class="stat-label">Pérdidas</div>
                <div id="pay-stat-loss-main" class="stat-value" style="color: #dc2626;">$0.00</div>
                <div class="stat-sub">Teórico vs Real</div>
            </div>
            <div class="stat-card-premium" style="border-left-color: #f59e0b;">
                <div class="stat-label">Por Cobrar</div>
                <div id="pay-stat-pending-main" class="stat-value">$0.00</div>
                <div class="stat-sub">Cartera pendiente</div>
            </div>
        </div>

        <div class="panels-grid-premium" style="display: grid; grid-template-columns: 1fr 1.5fr; gap: 24px;">
            <div class="glass-panel" style="padding: 24px; border-radius: 16px;">
                <h3 style="margin-bottom: 20px; font-size: 1.1rem; font-weight: 800; color: #1e293b;">
                    <i class="fas fa-wallet" style="color: #6366f1; margin-right: 10px;"></i>Métodos de Pago
                </h3>
                <div id="method-breakdown-main" style="display: flex; flex-direction: column; gap: 12px;">
                    <div style="padding: 20px; text-align: center; color: #94a3b8;">Cargando...</div>
                </div>
            </div>
            <div class="glass-panel" style="padding: 24px; border-radius: 16px;">
                <h3 style="margin-bottom: 20px; font-size: 1.1rem; font-weight: 800; color: #1e293b;">
                    <i class="fas fa-chart-line" style="color: #6366f1; margin-right: 10px;"></i>Tendencia Mensual
                </h3>
                <div style="height: 300px; position: relative;">
                    <canvas id="revenue-chart-main"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Tab 2: Egresos -->
    <div id="finance-tab-egresos" class="finance-tab-content">
        <div class="stat-grid-premium"
            style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px;">
            <div class="stat-card-premium" style="border-left-color: #f43f5e;">
                <div class="stat-label">Total Gastos</div>
                <div id="pay-stat-expenses-main" class="stat-value" style="color: #e11d48;">$0.00</div>
                <div class="stat-sub">Egresos registrados</div>
            </div>
            <div class="stat-card-premium" style="border-left-color: #10b981;">
                <div class="stat-label">Utilidad Neta</div>
                <div id="pay-stat-net-main" class="stat-value" style="color: #059669;">$0.00</div>
                <div class="stat-sub">Caja operacional</div>
            </div>
        </div>

        <div class="glass-panel" style="padding: 24px; border-radius: 16px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="margin: 0; font-size: 1.1rem; font-weight: 800; color: #1e293b;">Detalle de Gastos</h3>
                <button class="btn-primary" onclick="if(window.app) window.app.modules.payments.showNewExpenseModal()">
                    <i class="fas fa-plus"></i> Nuevo Gasto
                </button>
            </div>
            <div id="expenses-summary-table-view">
                <table class="premium-data-table" style="width: 100%;">
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Descripción</th>
                            <th>Categoría</th>
                            <th style="text-align: right;">Monto</th>
                            <th style="text-align: right;">Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="expenses-summary-table-body">
                        <tr>
                            <td colspan="5" style="text-align: center; padding: 20px; color: #94a3b8;">No hay gastos
                                registrados</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div id="expenses-summary-cards-grid" class="cards-grid-premium"
                style="display: none; grid-template-columns: 1fr; gap: 16px;">
                <!-- Cards rendered by JS -->
            </div>
        </div>
    </div>

    <!-- Tab 3: Perdidas -->
    <div id="finance-tab-perdidas" class="finance-tab-content">
        <div class="stat-grid-premium"
            style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px;">
            <div class="stat-card-premium" style="border-left-color: #ef4444;">
                <div class="stat-label">Pérdida FX</div>
                <div id="loss-stat-fx" class="stat-value">$0.00</div>
                <div class="stat-sub">Variación cambiaria</div>
            </div>
            <div class="stat-card-premium" style="border-left-color: #f59e0b;">
                <div class="stat-label">Descuentos Mora</div>
                <div id="loss-stat-prorating" class="stat-value">$0.00</div>
                <div class="stat-sub">Prorrateo aplicado</div>
            </div>
            <div class="stat-card-premium" style="border-left-color: #64748b;">
                <div class="stat-label">Cartera Castigada</div>
                <div id="loss-stat-bad-debt" class="stat-value">$0.00</div>
                <div class="stat-sub">Impagos/Retiros</div>
            </div>
        </div>

        <div class="glass-panel" style="padding: 24px; border-radius: 16px;">
            <h3 style="margin-bottom: 20px; font-size: 1.1rem; font-weight: 800; color: #1e293b;">
                <i class="fas fa-search-dollar" style="color: #64748b; margin-right: 10px;"></i>Análisis de Fugas
            </h3>
            <div id="losses-table-view">
                <table class="premium-data-table" style="width: 100%;">
                    <thead>
                        <tr>
                            <th>Concepto / Cliente</th>
                            <th>Categoría</th>
                            <th>Fecha</th>
                            <th style="text-align: right;">Monto</th>
                        </tr>
                    </thead>
                    <tbody id="losses-table-body">
                        <tr>
                            <td colspan="4" style="text-align: center; padding: 20px; color: #94a3b8;">No hay fugas
                                detectadas</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div id="losses-cards-grid" class="cards-grid-premium"
                style="display: none; grid-template-columns: 1fr; gap: 16px;">
                <!-- Cards rendered by JS -->
            </div>
        </div>
    </div>
</div>

<style>
    #finance-overview-view .finance-tab-content {
        display: none;
        animation: tabFadeIn 0.3s ease;
    }

    #finance-overview-view .finance-tab-content.active {
        display: block !important;
    }

    #finance-overview-view .stat-card-premium {
        background: #ffffff;
        padding: 16px;
        border-radius: 16px;
        border-left: 5px solid #cbd5e1;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        transition: all 0.3s ease;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }

    #finance-overview-view .stat-card-premium:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
    }

    #finance-overview-view .stat-label {
        font-size: 0.7rem;
        font-weight: 800;
        text-transform: uppercase;
        color: #64748b;
        margin-bottom: 6px;
        letter-spacing: 0.05em;
    }

    #finance-overview-view .stat-value {
        font-size: 1.4rem;
        font-weight: 950;
        color: #0f172a;
        line-height: 1.2;
    }

    #finance-overview-view .stat-sub {
        font-size: 0.75rem;
        color: #94a3b8;
        margin-top: 4px;
        font-weight: 600;
    }

    #finance-overview-view .finance-tab-btn {
        padding: 10px 20px;
        border: none;
        background: transparent;
        color: #64748b;
        font-weight: 700;
        cursor: pointer;
        border-radius: 12px;
        display: flex;
        align-items: center;
        gap: 10px;
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        white-space: nowrap;
    }

    #finance-overview-view .finance-tab-btn i {
        font-size: 1rem;
    }

    #finance-overview-view .finance-tab-btn.active {
        background: #4f46e5;
        color: white;
        box-shadow: 0 4px 12px rgba(79, 70, 233, 0.3);
    }

    /* Media Queries para Mobile */
    @media (max-width: 1100px) {
        #finance-overview-view .view-header {
            flex-direction: column;
            align-items: flex-start !important;
            gap: 20px;
        }

        #finance-overview-view .header-left {
            width: 100%;
        }

        #finance-overview-view .header-right {
            width: 100%;
        }

        #finance-overview-view .financial-clock-premium {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.5);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.8);
        }

        #finance-overview-view .finance-tabs-premium {
            overflow-x: auto;
            padding-bottom: 15px !important;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        #finance-overview-view .finance-tabs-premium::-webkit-scrollbar {
            display: none;
        }

        #finance-overview-view .stat-grid-premium {
            grid-template-columns: 1fr !important;
            gap: 12px !important;
        }

        #finance-overview-view .panels-grid-premium {
            grid-template-columns: 1fr !important;
            gap: 20px !important;
        }

        #finance-overview-view .stat-value {
            font-size: 1.6rem;
            /* Un poco más grande en móvil para legibilidad */
        }
    }

    @keyframes tabFadeIn {
        from {
            opacity: 0;
            transform: translateY(10px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
</style>